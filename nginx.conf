worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/json;

    sendfile        on;
    keepalive_timeout  65;

    # Upstream blocks for better organization
    upstream user_service {
        server user-services-train-ticket-management.onrender.com:443;
    }

    upstream train_service {
        server user-services-train-ticket-management-bq5j.onrender.com:443;
    }

    upstream ticket_service {
        server ticket-service-train-ticket-management.onrender.com:443;
    }

    server {
        listen       80;
        server_name  localhost;

        # ===============================
        # User Service
        # ===============================
        location /api/users {
            proxy_pass https://user_service/api/users;
            proxy_set_header Host user-services-train-ticket-management.onrender.com;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_ssl_server_name on;
        }

        location /api/login {
            proxy_pass https://user_service/api/login;
            proxy_set_header Host user-services-train-ticket-management.onrender.com;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_ssl_server_name on;
        }

        location /api/admins {
            proxy_pass https://user_service/api/admins;
            proxy_set_header Host user-services-train-ticket-management.onrender.com;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_ssl_server_name on;
        }

        # ===============================
        # Train Service
        # ===============================
        location /api/train {
            proxy_pass https://train_service/api/train;
            proxy_set_header Host user-services-train-ticket-management-bq5j.onrender.com;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_ssl_server_name on;
        }

        location /api/station {
            proxy_pass https://train_service/api/station;
            proxy_set_header Host user-services-train-ticket-management-bq5j.onrender.com;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_ssl_server_name on;
        }

        location /api/schedule {
            proxy_pass https://train_service/api/schedule;
            proxy_set_header Host user-services-train-ticket-management-bq5j.onrender.com;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_ssl_server_name on;
        }

        # ===============================
        # Ticket Service
        # ===============================
        location /api/findTrain {
            proxy_pass https://ticket_service/api/findTrain;
            proxy_set_header Host ticket-service-train-ticket-management.onrender.com;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_ssl_server_name on;
        }

        location /api/ticket {
            proxy_pass https://ticket_service/api/ticket;
            proxy_set_header Host ticket-service-train-ticket-management.onrender.com;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_ssl_server_name on;
        }

        # Health check endpoint
        location /health {
            return 200 '{"status": "OK", "message": "NGINX is running"}';
            add_header Content-Type application/json;
        }
    }
}